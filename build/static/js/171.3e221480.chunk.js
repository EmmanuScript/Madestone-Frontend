"use strict";(self.webpackChunkmadestone_frontend=self.webpackChunkmadestone_frontend||[]).push([[171],{171:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var r=n(555),c=n(43),a=n(481),s=n(607),o=n(579);function i(e){let{token:t,userId:n,onCoachClick:i}=e;const[d,l]=(0,c.useState)([]),[h,u]=(0,c.useState)(null),[f,b]=(0,c.useState)([]),[j,x]=(0,c.useState)({}),[p,m]=(0,c.useState)(!1),[y,g]=(0,c.useState)(!1),{success:k,error:S}=(0,s.Y)();async function v(e){const n=await fetch("".concat(a.JR,"/users/coaches"),{headers:{Authorization:"Bearer "+t}});if(!n.ok)return l([]);const r=(await n.json()).filter(t=>!1!==t.active&&t.center&&t.center.id===e);l(r)}(0,c.useEffect)(()=>{!async function(){try{let r=n;if(!r&&t)try{r=JSON.parse(atob(t.split(".")[1])).sub}catch(e){}if(r){const n=await fetch("".concat(a.JR,"/users/").concat(r),{headers:{Authorization:"Bearer "+t}});if(n.ok){const r=await n.json();if("CEO"===r.role)return g(!0),void await async function(){try{const e=await fetch("".concat(a.JR,"/centers"),{headers:{Authorization:"Bearer "+t}});if(e.ok){const t=await e.json();b(t),t.length>0&&u(t[0].id)}}catch(e){console.error("Failed to fetch centers",e)}}();const c=r.center&&r.center.id;if(c)return void u(c)}}}catch(e){console.error("Failed to fetch user info",e)}}()},[n]),(0,c.useEffect)(()=>{h&&v(h)},[h]);const C=Object.keys(j).length>0;return(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Mark Coach Attendance"}),y&&f.length>0&&(0,o.jsxs)("div",{style:{marginBottom:20},children:[(0,o.jsx)("label",{htmlFor:"center-select",style:{marginRight:10,fontWeight:"bold"},children:"Select Center:"}),(0,o.jsx)("select",{id:"center-select",value:h||"",onChange:e=>u(Number(e.target.value)),style:{padding:"8px 12px",fontSize:14,borderRadius:4,border:"1px solid #ccc"},children:f.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,o.jsxs)("table",{className:"students",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Coach Name"}),(0,o.jsx)("th",{children:"Center"}),(0,o.jsx)("th",{children:"Status"}),(0,o.jsx)("th",{children:"Actions"})]})}),(0,o.jsx)("tbody",{children:d.map(e=>{var t;const n=j[e.id],c=!0===n?"#d4f4dd":!1===n?"#ffd4d4":"transparent";return(0,o.jsxs)("tr",{style:{background:c},children:[(0,o.jsx)("td",{children:(0,o.jsx)("button",{onClick:()=>i&&i(e.id),style:{background:"none",border:"none",padding:0,margin:0,color:"#2a7",textDecoration:"underline",cursor:"pointer"},children:e.name})}),(0,o.jsx)("td",{children:(null===(t=e.center)||void 0===t?void 0:t.name)||"-"}),(0,o.jsx)("td",{children:!0===n?"Present":!1===n?"Absent":"Not Marked"}),(0,o.jsx)("td",{children:(0,o.jsxs)("button",{onClick:()=>{return t=e.id,void x(e=>{const n=e[t];return void 0===n||!1===n?(0,r.A)((0,r.A)({},e),{},{[t]:!0}):(0,r.A)((0,r.A)({},e),{},{[t]:!1})});var t},children:["Mark ",!0===n?"Absent":"Present"]})})]},e.id)})})]}),C&&(0,o.jsx)("div",{style:{marginTop:20},children:(0,o.jsx)("button",{onClick:async function(){const e=(new Date).toISOString().slice(0,10);m(!0);try{const n=Object.entries(j).map(n=>{let[r,c]=n;return fetch("".concat(a.JR,"/coach-attendance/mark"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t},body:JSON.stringify({coachId:Number(r),date:e,present:c})})});await Promise.all(n),x({}),k("Coach attendance submitted successfully!"),h&&v(h)}catch(n){S("Failed to submit coach attendance. Please try again.")}finally{m(!1)}},disabled:p,style:{padding:"10px 20px",fontSize:16,background:"#2a7",color:"#fff",border:"none",cursor:p?"not-allowed":"pointer",opacity:p?.6:1},children:p?"Submitting...":"Submit Coach Attendance"})})]})}}}]);
//# sourceMappingURL=171.3e221480.chunk.js.map