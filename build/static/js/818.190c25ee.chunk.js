"use strict";(self.webpackChunkmadestone_frontend=self.webpackChunkmadestone_frontend||[]).push([[818],{818:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(43),r=n(481),o=n(579);function d(e){let{token:t,onStudentClick:n}=e;const[d,i]=(0,a.useState)([]),[c,l]=(0,a.useState)([]),[s,h]=(0,a.useState)(""),[x,p]=(0,a.useState)(""),[u,f]=(0,a.useState)(""),[g,m]=(0,a.useState)([]),[y,j]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null),[b,S]=(0,a.useState)("");(0,a.useEffect)(()=>{!async function(){const e=await fetch("".concat(r.JR,"/centers"),{headers:{Authorization:"Bearer "+t}}),n=await e.json();i(n.sort((e,t)=>(e.name||"").localeCompare(t.name||"")))}(),async function(){const e=await fetch("".concat(r.JR,"/students"),{headers:{Authorization:"Bearer "+t}});l(await e.json())}()},[]);const k={},C=new Set;g.forEach(e=>{var t,n,a,r,o;const d=null===(t=e.student)||void 0===t?void 0:t.id,i=(null===(n=e.student)||void 0===n?void 0:n.name)||"Unknown",c=(null===(a=e.student)||void 0===a||null===(r=a.center)||void 0===r?void 0:r.name)||"-",l=(null===(o=e.student)||void 0===o?void 0:o.category)||"-",s=e.date;k[d]||(k[d]={id:d,name:i,center:c,category:l,dates:{}}),k[d].dates[s]=e.present?"\u2713":"\u2717",C.add(s)});const B=Array.from(C).sort();let A=Object.values(k).sort((e,t)=>(e.name||"").localeCompare(t.name||""));b.trim()&&(A=A.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())));s&&c.filter(e=>{var t;return(null===(t=e.center)||void 0===t?void 0:t.id)===Number(s)});return(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Student Attendance History"}),(0,o.jsx)("div",{style:{marginBottom:12},children:(0,o.jsx)("input",{type:"text",placeholder:"\ud83d\udd0d Search student by name...",value:b,onChange:e=>S(e.target.value),style:{padding:"8px 12px",fontSize:14,borderRadius:4,border:"1px solid #ccc",width:"100%",maxWidth:"300px"}})}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:[(0,o.jsxs)("select",{value:s,onChange:e=>h(e.target.value),children:[(0,o.jsx)("option",{value:"",children:"-- Select center --"}),d.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,o.jsxs)("label",{children:["From",(0,o.jsx)("input",{type:"date",value:x,onChange:e=>p(e.target.value)})]}),(0,o.jsxs)("label",{children:["To",(0,o.jsx)("input",{type:"date",value:u,onChange:e=>f(e.target.value)})]})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,o.jsx)("button",{onClick:async()=>{if(w(null),!s)return w("Select a center first");if(!x||!u)return w("Start and end dates are required");if(function(e,t){if(!e||!t)return 0;const n=new Date(e),a=new Date(t);return Math.ceil((a-n)/864e5)+1}(x,u)>31)return w("Max allowed range is 1 month. Use export for larger ranges.");j(!0);try{const e=await fetch("".concat(r.JR,"/attendance/center/").concat(s,"?start=").concat(x,"&end=").concat(u),{headers:{Authorization:"Bearer "+t}});if(!e.ok)throw new Error("Failed to fetch attendance");const n=await e.json();m(n)}catch(e){w(e.message||"Failed to load")}finally{j(!1)}},disabled:y,style:{padding:"8px 24px",minWidth:"120px"},children:"Fetch"}),(0,o.jsx)("button",{onClick:async()=>{if(!s)return w("Select a center to export");if(!x||!u)return w("Start and end dates are required for export");try{const e=await fetch("".concat(r.JR,"/attendance/export/center/").concat(s,"?start=").concat(x,"&end=").concat(u),{headers:{Authorization:"Bearer "+t}});if(!e.ok)throw new Error("Export failed");const n=await e.text(),a=new Blob([n],{type:"text/csv"}),o=window.URL.createObjectURL(a),d=document.createElement("a");d.href=o,d.download="attendance-center-".concat(s,".csv"),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(o)}catch(e){w(e.message||"Export failed")}},style:{padding:"8px 24px",minWidth:"120px"},children:"Export (CSV)"})]}),v&&(0,o.jsx)("div",{style:{color:"#b00"},children:v}),y&&(0,o.jsx)("div",{children:"Loading..."}),!y&&A.length>0&&(0,o.jsx)("div",{style:{overflowX:"auto"},children:(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:"600px"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{textAlign:"left",borderBottom:"2px solid #333",padding:"8px",position:"sticky",left:0,background:"#f5f5f5",color:"#111",zIndex:10},children:"Name"}),(0,o.jsx)("th",{style:{textAlign:"left",borderBottom:"2px solid #333",padding:"8px"},children:"Center"}),(0,o.jsx)("th",{style:{textAlign:"left",borderBottom:"2px solid #333",padding:"8px"},children:"Category"}),B.map(e=>(0,o.jsx)("th",{style:{textAlign:"center",borderBottom:"2px solid #333",padding:"8px",whiteSpace:"nowrap"},children:e},e))]})}),(0,o.jsx)("tbody",{children:A.map((e,t)=>(0,o.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,o.jsx)("td",{style:{padding:"8px",fontWeight:"500",position:"sticky",left:0,background:"#f5f5f5",zIndex:5},children:(0,o.jsx)("button",{onClick:()=>n&&n(e.id),style:{background:"none",border:"none",padding:0,margin:0,color:"#2a7",textDecoration:"underline",cursor:"pointer",fontWeight:"500"},children:e.name})}),(0,o.jsx)("td",{style:{padding:"8px"},children:e.center}),(0,o.jsx)("td",{style:{padding:"8px"},children:e.category}),B.map(t=>(0,o.jsx)("td",{style:{padding:"8px",textAlign:"center",color:"\u2713"===e.dates[t]?"green":"\u2717"===e.dates[t]?"red":"#ccc",fontWeight:"bold",fontSize:"18px"},children:e.dates[t]||"-"},t))]},t))})]})}),!y&&0===A.length&&0===g.length&&(0,o.jsx)("div",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"No attendance records found. Select a center and date range, then click Fetch."})]})}}}]);
//# sourceMappingURL=818.190c25ee.chunk.js.map