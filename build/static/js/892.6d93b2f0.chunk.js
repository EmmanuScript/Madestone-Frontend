"use strict";(self.webpackChunkmadestone_frontend=self.webpackChunkmadestone_frontend||[]).push([[892],{892:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(43),a=n(481),o=n(579);function d(e){let{token:t,onCoachClick:n}=e;const[d,c]=(0,r.useState)([]),[i,l]=(0,r.useState)([]),[s,h]=(0,r.useState)(""),[u,x]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[m,g]=(0,r.useState)([]),[j,v]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{!async function(){const e=await fetch("".concat(a.JR,"/centers"),{headers:{Authorization:"Bearer "+t}}),n=await e.json();c(n.sort((e,t)=>(e.name||"").localeCompare(t.name||"")))}(),async function(){const e=await fetch("".concat(a.JR,"/users/coaches"),{headers:{Authorization:"Bearer "+t}}),n=await e.json();l(n.sort((e,t)=>(e.name||"").localeCompare(t.name||"")))}()},[]);const w={},k=new Set;m.forEach(e=>{var t,n,r,a;const o=null===(t=e.coach)||void 0===t?void 0:t.id,d=(null===(n=e.coach)||void 0===n?void 0:n.name)||"Unknown",c=(null===(r=e.coach)||void 0===r||null===(a=r.center)||void 0===a?void 0:a.name)||"-",i=e.date;w[o]||(w[o]={id:o,name:d,center:c,dates:{}}),w[o].dates[i]=e.present?"\u2713":"\u2717",k.add(i)});const C=Array.from(k).sort(),S=Object.values(w),B=s?i.filter(e=>{var t;return(null===(t=e.center)||void 0===t?void 0:t.id)===Number(s)}):i;return(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Coach Attendance History"}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:[(0,o.jsxs)("select",{value:s,onChange:e=>h(e.target.value),children:[(0,o.jsx)("option",{value:"",children:"-- Select center --"}),d.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,o.jsxs)("label",{children:["From",(0,o.jsx)("input",{type:"date",value:u,onChange:e=>x(e.target.value)})]}),(0,o.jsxs)("label",{children:["To",(0,o.jsx)("input",{type:"date",value:p,onChange:e=>f(e.target.value)})]})]}),(0,o.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,o.jsx)("button",{onClick:async()=>{if(y(null),!s)return y("Select a center first");if(!u||!p)return y("Start and end dates are required");if(function(e,t){if(!e||!t)return 0;const n=new Date(e),r=new Date(t);return Math.ceil((r-n)/864e5)+1}(u,p)>31)return y("Max allowed range is 1 month. Use export for larger ranges.");v(!0);try{const e=await fetch("".concat(a.JR,"/coach-attendance/center/").concat(s,"?start=").concat(u,"&end=").concat(p),{headers:{Authorization:"Bearer "+t}});if(!e.ok)throw new Error("Failed to fetch coach attendance");const n=await e.json();g(n)}catch(e){y(e.message||"Failed to load")}finally{v(!1)}},disabled:j,style:{padding:"8px 24px",minWidth:"120px"},children:"Fetch"}),(0,o.jsx)("button",{onClick:async()=>{if(!s)return y("Select a center to export");if(!u||!p)return y("Start and end dates are required for export");try{const e=await fetch("".concat(a.JR,"/coach-attendance/export/center/").concat(s,"?start=").concat(u,"&end=").concat(p),{headers:{Authorization:"Bearer "+t}});if(!e.ok)throw new Error("Export failed");const n=await e.text(),r=new Blob([n],{type:"text/csv"}),o=window.URL.createObjectURL(r),d=document.createElement("a");d.href=o,d.download="coach-attendance-center-".concat(s,".csv"),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(o)}catch(e){y(e.message||"Export failed")}},style:{padding:"8px 24px",minWidth:"120px"},children:"Export (CSV)"})]}),b&&(0,o.jsx)("div",{style:{color:"#b00"},children:b}),j&&(0,o.jsx)("div",{children:"Loading..."}),!j&&S.length>0&&(0,o.jsx)("div",{style:{overflowX:"auto"},children:(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:"600px"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{style:{textAlign:"left",borderBottom:"2px solid #333",padding:"8px",position:"sticky",left:0,background:"#f5f5f5",color:"#111",zIndex:10},children:"Coach Name"}),(0,o.jsx)("th",{style:{textAlign:"left",borderBottom:"2px solid #333",padding:"8px",background:"#f5f5f5",color:"#111"},children:"Center"}),C.map(e=>(0,o.jsx)("th",{style:{borderBottom:"2px solid #333",padding:"8px",textAlign:"center",background:"#f5f5f5",color:"#111",minWidth:"80px"},children:e},e))]})}),(0,o.jsx)("tbody",{children:S.map(e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:{padding:"8px",borderBottom:"1px solid #ddd",position:"sticky",left:0,background:"#fff",zIndex:5},children:(0,o.jsx)("button",{onClick:()=>n&&n(e.id),style:{background:"none",border:"none",padding:0,margin:0,color:"#2a7",textDecoration:"underline",cursor:"pointer"},children:e.name})}),(0,o.jsx)("td",{style:{padding:"8px",borderBottom:"1px solid #ddd",background:"#fff"},children:e.center}),C.map(t=>{const n=e.dates[t]||"-",r="\u2713"===n?"#d4f4dd":"\u2717"===n?"#ffd4d4":"transparent";return(0,o.jsx)("td",{style:{padding:"8px",textAlign:"center",borderBottom:"1px solid #ddd",background:r},children:n},t)})]},e.id))})]})}),!j&&!b&&0===S.length&&0===m.length&&(0,o.jsx)("div",{style:{color:"#666",marginTop:12},children:"No attendance records found for the selected criteria."}),!j&&s&&B.length>0&&(0,o.jsxs)("div",{style:{marginTop:24},children:[(0,o.jsx)("h4",{children:"Coaches in Selected Center"}),(0,o.jsx)("ul",{children:B.map(e=>{var t;return(0,o.jsxs)("li",{children:[(0,o.jsx)("button",{onClick:()=>n&&n(e.id),style:{background:"none",border:"none",padding:0,margin:0,color:"#2a7",textDecoration:"underline",cursor:"pointer"},children:e.name})," - ",(null===(t=e.center)||void 0===t?void 0:t.name)||"No center"]},e.id)})})]})]})}}}]);
//# sourceMappingURL=892.6d93b2f0.chunk.js.map