{"version":3,"file":"static/js/818.190c25ee.chunk.js","mappings":"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","sources":["pages/AttendanceHistory.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { API_BASE_URL } from \"../config/api\";\n\nexport default function AttendanceHistory({ token, onStudentClick }) {\n  const [centers, setCenters] = useState([]);\n  const [students, setStudents] = useState([]);\n  const [centerId, setCenterId] = useState(\"\");\n  const [start, setStart] = useState(\"\");\n  const [end, setEnd] = useState(\"\");\n  const [records, setRecords] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  useEffect(() => {\n    fetchCenters();\n    fetchStudents();\n  }, []);\n\n  async function fetchCenters() {\n    const res = await fetch(`${API_BASE_URL}/centers`, {\n      headers: { Authorization: \"Bearer \" + token },\n    });\n    const data = await res.json();\n    // Sort centers alphabetically by name\n    setCenters(data.sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\")));\n  }\n\n  async function fetchStudents() {\n    const res = await fetch(`${API_BASE_URL}/students`, {\n      headers: { Authorization: \"Bearer \" + token },\n    });\n    setStudents(await res.json());\n  }\n\n  function daysBetween(s, e) {\n    if (!s || !e) return 0;\n    const a = new Date(s);\n    const b = new Date(e);\n    const diff = Math.ceil((b - a) / (1000 * 60 * 60 * 24)) + 1; // inclusive\n    return diff;\n  }\n\n  const fetchAttendance = async () => {\n    setError(null);\n    if (!centerId) return setError(\"Select a center first\");\n    if (!start || !end) return setError(\"Start and end dates are required\");\n    const diff = daysBetween(start, end);\n    if (diff > 31)\n      return setError(\n        \"Max allowed range is 1 month. Use export for larger ranges.\"\n      );\n\n    setLoading(true);\n    try {\n      const res = await fetch(\n        `${API_BASE_URL}/attendance/center/${centerId}?start=${start}&end=${end}`,\n        { headers: { Authorization: \"Bearer \" + token } }\n      );\n      if (!res.ok) throw new Error(\"Failed to fetch attendance\");\n      const data = await res.json();\n      setRecords(data);\n    } catch (err) {\n      setError(err.message || \"Failed to load\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const exportCenter = async () => {\n    if (!centerId) return setError(\"Select a center to export\");\n    if (!start || !end)\n      return setError(\"Start and end dates are required for export\");\n    // allow export for any range\n    try {\n      const res = await fetch(\n        `${API_BASE_URL}/attendance/export/center/${centerId}?start=${start}&end=${end}`,\n        { headers: { Authorization: \"Bearer \" + token } }\n      );\n      if (!res.ok) throw new Error(\"Export failed\");\n      const text = await res.text();\n      const blob = new Blob([text], { type: \"text/csv\" });\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `attendance-center-${centerId}.csv`;\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      setError(err.message || \"Export failed\");\n    }\n  };\n\n  // Group records by student\n  const groupedData = {};\n  const allDates = new Set();\n\n  records.forEach((record) => {\n    const studentId = record.student?.id;\n    const studentName = record.student?.name || \"Unknown\";\n    const centerName = record.student?.center?.name || \"-\";\n    const category = record.student?.category || \"-\";\n    const date = record.date;\n\n    if (!groupedData[studentId]) {\n      groupedData[studentId] = {\n        id: studentId,\n        name: studentName,\n        center: centerName,\n        category: category,\n        dates: {},\n      };\n    }\n\n    groupedData[studentId].dates[date] = record.present ? \"âœ“\" : \"âœ—\";\n    allDates.add(date);\n  });\n\n  const sortedDates = Array.from(allDates).sort();\n  // Sort students alphabetically and filter by search\n  let studentsData = Object.values(groupedData).sort((a, b) =>\n    (a.name || \"\").localeCompare(b.name || \"\")\n  );\n  if (searchQuery.trim()) {\n    studentsData = studentsData.filter((s) =>\n      s.name.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n  }\n\n  const studentsForCenter = centerId\n    ? students.filter((s) => s.center?.id === Number(centerId))\n    : students;\n\n  return (\n    <div>\n      <h3>Student Attendance History</h3>\n\n      <div style={{ marginBottom: 12 }}>\n        <input\n          type=\"text\"\n          placeholder=\"ðŸ” Search student by name...\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          style={{\n            padding: \"8px 12px\",\n            fontSize: 14,\n            borderRadius: 4,\n            border: \"1px solid #ccc\",\n            width: \"100%\",\n            maxWidth: \"300px\",\n          }}\n        />\n      </div>\n\n      <div\n        style={{ display: \"flex\", gap: 8, flexWrap: \"wrap\", marginBottom: 12 }}\n      >\n        <select value={centerId} onChange={(e) => setCenterId(e.target.value)}>\n          <option value=\"\">-- Select center --</option>\n          {centers.map((c) => (\n            <option key={c.id} value={c.id}>\n              {c.name}\n            </option>\n          ))}\n        </select>\n\n        <label>\n          From\n          <input\n            type=\"date\"\n            value={start}\n            onChange={(e) => setStart(e.target.value)}\n          />\n        </label>\n        <label>\n          To\n          <input\n            type=\"date\"\n            value={end}\n            onChange={(e) => setEnd(e.target.value)}\n          />\n        </label>\n      </div>\n\n      <div style={{ display: \"flex\", gap: 8, marginBottom: 12 }}>\n        <button\n          onClick={fetchAttendance}\n          disabled={loading}\n          style={{ padding: \"8px 24px\", minWidth: \"120px\" }}\n        >\n          Fetch\n        </button>\n\n        <button\n          onClick={exportCenter}\n          style={{ padding: \"8px 24px\", minWidth: \"120px\" }}\n        >\n          Export (CSV)\n        </button>\n      </div>\n\n      {error && <div style={{ color: \"#b00\" }}>{error}</div>}\n\n      {loading && <div>Loading...</div>}\n\n      {!loading && studentsData.length > 0 && (\n        <div style={{ overflowX: \"auto\" }}>\n          <table\n            style={{\n              width: \"100%\",\n              borderCollapse: \"collapse\",\n              minWidth: \"600px\",\n            }}\n          >\n            <thead>\n              <tr>\n                <th\n                  style={{\n                    textAlign: \"left\",\n                    borderBottom: \"2px solid #333\",\n                    padding: \"8px\",\n                    position: \"sticky\",\n                    left: 0,\n                    background: \"#f5f5f5\",\n                    color: \"#111\",\n                    zIndex: 10,\n                  }}\n                >\n                  Name\n                </th>\n                <th\n                  style={{\n                    textAlign: \"left\",\n                    borderBottom: \"2px solid #333\",\n                    padding: \"8px\",\n                  }}\n                >\n                  Center\n                </th>\n                <th\n                  style={{\n                    textAlign: \"left\",\n                    borderBottom: \"2px solid #333\",\n                    padding: \"8px\",\n                  }}\n                >\n                  Category\n                </th>\n                {sortedDates.map((date) => (\n                  <th\n                    key={date}\n                    style={{\n                      textAlign: \"center\",\n                      borderBottom: \"2px solid #333\",\n                      padding: \"8px\",\n                      whiteSpace: \"nowrap\",\n                    }}\n                  >\n                    {date}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody>\n              {studentsData.map((student, idx) => (\n                <tr key={idx} style={{ borderBottom: \"1px solid #eee\" }}>\n                  <td\n                    style={{\n                      padding: \"8px\",\n                      fontWeight: \"500\",\n                      position: \"sticky\",\n                      left: 0,\n                      background: \"#f5f5f5\",\n                      zIndex: 5,\n                    }}\n                  >\n                    <button\n                      onClick={() =>\n                        onStudentClick && onStudentClick(student.id)\n                      }\n                      style={{\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        margin: 0,\n                        color: \"#2a7\",\n                        textDecoration: \"underline\",\n                        cursor: \"pointer\",\n                        fontWeight: \"500\",\n                      }}\n                    >\n                      {student.name}\n                    </button>\n                  </td>\n                  <td style={{ padding: \"8px\" }}>{student.center}</td>\n                  <td style={{ padding: \"8px\" }}>{student.category}</td>\n                  {sortedDates.map((date) => (\n                    <td\n                      key={date}\n                      style={{\n                        padding: \"8px\",\n                        textAlign: \"center\",\n                        color:\n                          student.dates[date] === \"âœ“\"\n                            ? \"green\"\n                            : student.dates[date] === \"âœ—\"\n                            ? \"red\"\n                            : \"#ccc\",\n                        fontWeight: \"bold\",\n                        fontSize: \"18px\",\n                      }}\n                    >\n                      {student.dates[date] || \"-\"}\n                    </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n\n      {!loading && studentsData.length === 0 && records.length === 0 && (\n        <div style={{ padding: \"20px\", textAlign: \"center\", color: \"#666\" }}>\n          No attendance records found. Select a center and date range, then\n          click Fetch.\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["AttendanceHistory","_ref","token","onStudentClick","centers","setCenters","useState","students","setStudents","centerId","setCenterId","start","setStart","end","setEnd","records","setRecords","loading","setLoading","error","setError","searchQuery","setSearchQuery","useEffect","async","res","fetch","concat","API_BASE_URL","headers","Authorization","data","json","sort","a","b","name","localeCompare","fetchCenters","fetchStudents","groupedData","allDates","Set","forEach","record","_record$student","_record$student2","_record$student3","_record$student3$cent","_record$student4","studentId","student","id","studentName","centerName","center","category","date","dates","present","add","sortedDates","Array","from","studentsData","Object","values","trim","filter","s","toLowerCase","includes","_s$center","Number","_jsxs","children","_jsx","style","marginBottom","type","placeholder","value","onChange","e","target","padding","fontSize","borderRadius","border","width","maxWidth","display","gap","flexWrap","map","c","onClick","Date","Math","ceil","daysBetween","ok","Error","err","message","disabled","minWidth","text","blob","Blob","url","window","URL","createObjectURL","document","createElement","href","download","body","appendChild","click","remove","revokeObjectURL","color","length","overflowX","borderCollapse","textAlign","borderBottom","position","left","background","zIndex","whiteSpace","idx","fontWeight","margin","textDecoration","cursor"],"sourceRoot":""}