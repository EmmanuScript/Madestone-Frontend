{"version":3,"file":"static/js/171.3e221480.chunk.js","mappings":"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","sources":["components/MarkCoachAttendance.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { API_BASE_URL } from \"../config/api\";\nimport { useToastContext } from \"./ToastProvider\";\n\nexport default function MarkCoachAttendance({ token, userId, onCoachClick }) {\n  const [coaches, setCoaches] = useState([]);\n  const [centerId, setCenterId] = useState(null);\n  const [centers, setCenters] = useState([]);\n  const [attendanceStatus, setAttendanceStatus] = useState({});\n  const [submitting, setSubmitting] = useState(false);\n  const [isCEO, setIsCEO] = useState(false);\n  const { success, error: showError } = useToastContext();\n\n  useEffect(() => {\n    fetchUserAndCoaches();\n  }, [userId]);\n\n  useEffect(() => {\n    if (centerId) {\n      fetchCoachesForCenter(centerId);\n    }\n  }, [centerId]);\n\n  async function fetchUserAndCoaches() {\n    try {\n      let uid = userId;\n      if (!uid && token) {\n        try {\n          const payload = JSON.parse(atob(token.split(\".\")[1]));\n          uid = payload.sub;\n        } catch (e) {\n          // ignore\n        }\n      }\n      if (uid) {\n        const ures = await fetch(`${API_BASE_URL}/users/${uid}`, {\n          headers: { Authorization: \"Bearer \" + token },\n        });\n        if (ures.ok) {\n          const u = await ures.json();\n\n          // Check if user is CEO\n          if (u.role === \"CEO\") {\n            setIsCEO(true);\n            await fetchAllCenters();\n            return;\n          }\n\n          // For non-CEO users (Admin), use their assigned center\n          const cid = u.center && u.center.id;\n          if (cid) {\n            setCenterId(cid);\n            return;\n          }\n        }\n      }\n    } catch (e) {\n      console.error(\"Failed to fetch user info\", e);\n    }\n  }\n\n  async function fetchAllCenters() {\n    try {\n      const res = await fetch(`${API_BASE_URL}/centers`, {\n        headers: { Authorization: \"Bearer \" + token },\n      });\n      if (res.ok) {\n        const data = await res.json();\n        setCenters(data);\n        // Auto-select first center if available\n        if (data.length > 0) {\n          setCenterId(data[0].id);\n        }\n      }\n    } catch (e) {\n      console.error(\"Failed to fetch centers\", e);\n    }\n  }\n\n  async function fetchCoachesForCenter(cid) {\n    const res = await fetch(`${API_BASE_URL}/users/coaches`, {\n      headers: { Authorization: \"Bearer \" + token },\n    });\n    if (!res.ok) return setCoaches([]);\n    const all = await res.json();\n    // Filter coaches by center and active status\n    const centerCoaches = all.filter(\n      (coach) =>\n        coach.active !== false && coach.center && coach.center.id === cid\n    );\n    setCoaches(centerCoaches);\n  }\n\n  function toggleAttendance(coachId) {\n    setAttendanceStatus((prev) => {\n      const currentStatus = prev[coachId];\n      if (currentStatus === undefined || currentStatus === false) {\n        return { ...prev, [coachId]: true };\n      } else {\n        return { ...prev, [coachId]: false };\n      }\n    });\n  }\n\n  async function submitAttendance() {\n    const today = new Date().toISOString().slice(0, 10);\n    setSubmitting(true);\n\n    try {\n      const promises = Object.entries(attendanceStatus).map(\n        ([coachId, present]) => {\n          return fetch(`${API_BASE_URL}/coach-attendance/mark`, {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              Authorization: \"Bearer \" + token,\n            },\n            body: JSON.stringify({\n              coachId: Number(coachId),\n              date: today,\n              present: present,\n            }),\n          });\n        }\n      );\n\n      await Promise.all(promises);\n      setAttendanceStatus({});\n      success(\"Coach attendance submitted successfully!\");\n      if (centerId) {\n        fetchCoachesForCenter(centerId);\n      }\n    } catch (err) {\n      showError(\"Failed to submit coach attendance. Please try again.\");\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  const hasAttendanceData = Object.keys(attendanceStatus).length > 0;\n\n  return (\n    <div>\n      <h3>Mark Coach Attendance</h3>\n      {isCEO && centers.length > 0 && (\n        <div style={{ marginBottom: 20 }}>\n          <label\n            htmlFor=\"center-select\"\n            style={{ marginRight: 10, fontWeight: \"bold\" }}\n          >\n            Select Center:\n          </label>\n          <select\n            id=\"center-select\"\n            value={centerId || \"\"}\n            onChange={(e) => setCenterId(Number(e.target.value))}\n            style={{\n              padding: \"8px 12px\",\n              fontSize: 14,\n              borderRadius: 4,\n              border: \"1px solid #ccc\",\n            }}\n          >\n            {centers.map((center) => (\n              <option key={center.id} value={center.id}>\n                {center.name}\n              </option>\n            ))}\n          </select>\n        </div>\n      )}\n      <table className=\"students\">\n        <thead>\n          <tr>\n            <th>Coach Name</th>\n            <th>Center</th>\n            <th>Status</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          {coaches.map((coach) => {\n            const status = attendanceStatus[coach.id];\n            const statusBg =\n              status === true\n                ? \"#d4f4dd\"\n                : status === false\n                ? \"#ffd4d4\"\n                : \"transparent\";\n\n            return (\n              <tr key={coach.id} style={{ background: statusBg }}>\n                <td>\n                  <button\n                    onClick={() => onCoachClick && onCoachClick(coach.id)}\n                    style={{\n                      background: \"none\",\n                      border: \"none\",\n                      padding: 0,\n                      margin: 0,\n                      color: \"#2a7\",\n                      textDecoration: \"underline\",\n                      cursor: \"pointer\",\n                    }}\n                  >\n                    {coach.name}\n                  </button>\n                </td>\n                <td>{coach.center?.name || \"-\"}</td>\n                <td>\n                  {status === true\n                    ? \"Present\"\n                    : status === false\n                    ? \"Absent\"\n                    : \"Not Marked\"}\n                </td>\n                <td>\n                  <button onClick={() => toggleAttendance(coach.id)}>\n                    Mark {status === true ? \"Absent\" : \"Present\"}\n                  </button>\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n      {hasAttendanceData && (\n        <div style={{ marginTop: 20 }}>\n          <button\n            onClick={submitAttendance}\n            disabled={submitting}\n            style={{\n              padding: \"10px 20px\",\n              fontSize: 16,\n              background: \"#2a7\",\n              color: \"#fff\",\n              border: \"none\",\n              cursor: submitting ? \"not-allowed\" : \"pointer\",\n              opacity: submitting ? 0.6 : 1,\n            }}\n          >\n            {submitting ? \"Submitting...\" : \"Submit Coach Attendance\"}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["MarkCoachAttendance","_ref","token","userId","onCoachClick","coaches","setCoaches","useState","centerId","setCenterId","centers","setCenters","attendanceStatus","setAttendanceStatus","submitting","setSubmitting","isCEO","setIsCEO","success","error","showError","useToastContext","async","fetchCoachesForCenter","cid","res","fetch","concat","API_BASE_URL","headers","Authorization","ok","centerCoaches","json","filter","coach","active","center","id","useEffect","uid","JSON","parse","atob","split","sub","e","ures","u","role","data","length","console","fetchAllCenters","fetchUserAndCoaches","hasAttendanceData","Object","keys","_jsxs","children","_jsx","style","marginBottom","htmlFor","marginRight","fontWeight","value","onChange","Number","target","padding","fontSize","borderRadius","border","map","name","className","_coach$center","status","statusBg","background","onClick","margin","color","textDecoration","cursor","toggleAttendance","coachId","prev","currentStatus","undefined","_objectSpread","marginTop","today","Date","toISOString","slice","promises","entries","_ref2","present","method","body","stringify","date","Promise","all","err","disabled","opacity"],"sourceRoot":""}